<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>webGL モアレ</title>
<link rel="stylesheet" href="common/css/style.css">
<script src="common/js/libs/minMatrixb.js"></script>
</head>
<body>
<div class="canvasWrap">
    <canvas id="canvas"></canvas>
</div>
<script id="VS" type="x-shader/x-vertex">
attribute vec3 position;
uniform mat4 mvpMatrix;

varying vec3 vPos;

void main(){
    vPos = position;
    gl_Position = mvpMatrix * vec4(vPos, 1.0);
}
</script>
<script id="FS" type="x-shader/x-fragment">
precision mediump float;

const float rad = 0.25;
const vec2 mid = vec2(0.5);
const ivec2 reps = ivec2(8, 8);
const float angle = 45.0;
const float RADIANS = angle * 0.0174532;
mat2 rot = mat2(vec2(cos(RADIANS) * 3.0, -sin(RADIANS) * 3.0), vec2(sin(RADIANS) * 3.0, cos(RADIANS) * 3.0));

uniform vec3 color;
varying vec3 vPos;

void main(){
	vec2 p = vPos.xy;
	p *= rot;

	vec2 q = p - vec2(0.5, 0.5);

	vec2 repeat = vec2(fract(q.x * float(reps.x)), fract(q.y * float(reps.y)));
	vec2 distFromMid = repeat - mid;

	float dist = length(distFromMid);
	float sharpness = 20.0;
	float circ = rad * sharpness - dist * sharpness;
    float alpha = 1.0 - circ;

    gl_FragColor = vec4(color, alpha);

}
</script>
<script src="common/js/run.js"></script>
</body></html>
